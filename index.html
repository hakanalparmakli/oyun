<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>AlparmaklÄ± Ailesi Oyunu</title>

<!-- ðŸ”¥ PWA / TAM EKRAN META -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#000000">

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;
 user-select:none;-webkit-user-select:none;
 -webkit-touch-callout:none;touch-action:none}
body{background:#000;color:#fff;font-family:Arial;overflow:hidden}
canvas{display:block}

#setup,#name,#overlay,#countdown{
 position:absolute;inset:0;display:flex;
 align-items:center;justify-content:center;
 flex-direction:column;background:#000;z-index:10
}
#countdown{font-size:140px;font-weight:bold;display:none}

#title{font-size:36px;font-weight:bold;margin-bottom:20px}
#qrcode{background:#fff;padding:15px;border-radius:10px}
#players{margin-top:10px;font-size:22px}

#mobile{display:none;position:fixed;inset:0;background:#000}
.pad{display:grid;grid-template-columns:1fr 1fr 1fr;height:100%}
.btn{
 margin:auto;width:80%;height:45%;
 border:4px solid #fff;border-radius:30px;
 font-size:60px;display:flex;align-items:center;justify-content:center
}
.jump{background:rgba(255,0,0,.35);font-size:70px}

input,button{font-size:24px;padding:10px;margin:10px}
</style>
</head>

<body>

<div id="setup">
 <div id="title">AlparmaklÄ± Ailesi Oyunu</div>
 <div id="qrcode"></div>
 <div id="players">Oyuncular: 0 / 10</div>
</div>

<div id="countdown"></div>
<div id="overlay" style="display:none"></div>

<div id="name" style="display:none">
 <h1>Ä°smini Gir</h1>
 <input id="playerName">
 <button id="join">KATIL</button>
</div>

<div id="mobile">
 <div class="pad">
  <div id="left" class="btn">â—€</div>
  <div id="jump" class="btn jump">ZIPLA</div>
  <div id="right" class="btn">â–¶</div>
 </div>
</div>

<canvas id="c"></canvas>

<script>
document.addEventListener("contextmenu",e=>e.preventDefault());

const canvas=c,ctx=canvas.getContext("2d");
canvas.width=innerWidth; canvas.height=innerHeight;

/* ðŸ”¥ TAM EKRAN FONKSÄ°YONU */
function goFullscreen(){
 const el=document.documentElement;
 if(el.requestFullscreen) el.requestFullscreen();
 else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
}

/* ================= PEER ================= */
const peer=new Peer();
const params=new URLSearchParams(location.search);
const peerId=params.get("peer");

/* ================= HOST ================= */
if(!peerId){
 peer.on("open",id=>{
  new QRCode(qrcode,{text:location.href+"?peer="+id,width:240,height:240});
 });
}
/* ================= MOBILE ================= */
else{
 // ðŸ”¥ SÄ°YAH EKRAN BUG FIX
 setup.style.display="none";
 name.style.display="flex";

 // Render garantisi
 setTimeout(()=>{ name.style.display="flex"; },50);

 peer.on("open",()=>{
  const conn=peer.connect(peerId);

  join.onclick=()=>{
   if(!playerName.value.trim()) return alert("Ä°sim gir");
   conn.send({type:"join",name:playerName.value.trim()});
   name.style.display="none";
   mobile.style.display="block";
   goFullscreen(); // ðŸ”¥ Ä°LK DOKUNUÅžTA TAM EKRAN
  };

  // Mobil tuÅŸlara basÄ±nca da fullscreen garanti
  ["left","right","jump"].forEach(id=>{
   document.getElementById(id).addEventListener("touchstart",()=>{
    goFullscreen();
   },{passive:true});
  });
 });
}
</script>

</body>
</html>
